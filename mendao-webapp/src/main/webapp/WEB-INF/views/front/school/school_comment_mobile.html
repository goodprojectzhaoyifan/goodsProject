<script th:inline="javascript">
/*<![CDATA[*/
function replayComment(id){
	if($("#login_status").val() == 0){
		$("#loginModal").modal();
	}else{
		$('#reply_textarea_'+id).toggle();
		$("#textarea_"+id).html("");
		$("#textarea_"+id).focus();
	}
}
function replayCommentChild(id,nickName){
	if($("#login_status").val() == 0){
		$("#loginModal").modal();
	}else{
		$('#reply_textarea_'+id).toggle();
		$("#textarea_"+id).html("回复 @"+nickName+":");
		$("#textarea_"+id).focus();
	}
}
function showChildComment(id){
	$("#child_comment_div_"+id).show();
	$("#show_child_comment_button_"+id).hide();
	$("#hide_child_comment_button_"+id).show();
}
function hideChildComment(id){
	$("#child_comment_div_"+id).hide();
	$("#show_child_comment_button_"+id).show();
	$("#hide_child_comment_button_"+id).hide();
}
//对评论的回复
function submitComment(id){
	var content = $("#textarea_"+id).val();
	if(content == ""){
		layer.open({
		    content: '请输入回复内容',
		    style: 'background-color:#09C1FF; color:#fff; border:none;',
		    time: 2
		});
		return;
	}
	var school_id = /*[[${school.id}]]*/;
	$.post(
			/*[[@{/front/m/school/submitChildCommit}]]*/,
			{ 'parent.id':id,'content':content,'school.id':school_id },
			function (data, status) {
				if(data.msg == 1){
					layer.open({
					    content: '评论成功',
					    style: 'background-color:#09C1FF; color:#fff; border:none;',
					    time: 2
					});
					$.get(
						/*[[@{'/front/school/showComment/'+${school.id}}]]*/,
						{ },
						function (data, status) {
							$("#school_comment").html(data);
					});
				}
			}
		);
}
function getCommentMore(){
	var url = /*[[@{'/front/school/showMoreComment/'+${school.id}}]]*/;
	var curpage = parseInt($("#current_page").val())+1;
	url += "?curpage="+curpage;
	$.get(
			url,
			{ },
			function (data, status) {
				alert(data);
				$("#school_comment_ul_list li:last").after(data);
				$("#current_page").val(curpage);
				if(curpage >= $("#total_page").val()){
					$("div.border0").hide();
				}
		});
}
/*]]>*/
</script>
<div class="panel panel-default panel-col box-shadow0" id="school_comment">
	<div class="panel-heading">全部评价（<span th:text="${school.commentNumber}">0</span>）</div>
	<div class="panel-body" style="padding-bottom: 0px;">
		<ul class="media-list" id="school_comment_ul_list">
			<li class="media" th:each="schoolComment : ${commentList}">
				<a class="pull-left" th:href="@{'/front/user/home?id='+${schoolComment.comment.author.id}}">
					<img th:if="${schoolComment.comment.author.icon}" th:src="@{${cdn}+${schoolComment.comment.author.icon}}" class="img-circle user-headimg"></img>
					<img th:if="${#strings.isEmpty(schoolComment.comment.author.icon)}" th:src="@{'/images/home/1.jpg'}" class="img-circle user-headimg"></img>
				</a>
				<div class="media-body">
					<div class="meta">
						<strong>
							<a th:href="@{'/front/user/home?id='+${schoolComment.comment.author.id}}"><span class="color-nickname" th:text="${schoolComment.comment.author.nickName}">用户昵称</span></a>
						</strong>
						<span class="mhm" th:text="${#dates.format(schoolComment.comment.createdDate, 'yyyy-MM-dd HH:mm')}">回复时间</span>
					</div>
					<div class="content">
						<p th:text="${schoolComment.comment.content}" style="margin-bottom:0px">评论内容</p>
					</div>
					<div class="text-muted text-normal pull-right">
						<a href="javascript:;" th:if="${#lists.size(schoolComment.childComment) == 0}" th:onclick="'replayComment('+${schoolComment.comment.id}+')'" class="reply">回复</a>
						<a href="javascript:;" th:if="${#lists.size(schoolComment.childComment) > 0}" th:style="${#lists.size(schoolComment.childComment) == 0}?'':'display:none;'" th:onclick="'showChildComment('+${schoolComment.comment.id}+')'" th:id="'show_child_comment_button_'+${schoolComment.comment.id}" class="reply">回复(<span th:text="${#lists.size(schoolComment.childComment)}">0</span>)</a>
						<a href="javascript:;" th:if="${#lists.size(schoolComment.childComment) > 0}" th:onclick="'hideChildComment('+${schoolComment.comment.id}+')'" th:id="'hide_child_comment_button_'+${schoolComment.comment.id}" class="reply">收起</a>
					</div>
					<div class="reply-block" th:id="'child_comment_div_'+${schoolComment.comment.id}" th:if="${#lists.size(schoolComment.childComment) > 0}">	
						<div class="well">
							<ul class="media-list">
								<li class="media" th:each="childComment : ${schoolComment.childComment}">
									<a class="pull-left"  th:href="@{'/front/user/home?id='+${childComment.author.id}}">
										<img th:if="${childComment.author.icon}" th:src="@{${cdn}+${childComment.author.icon}}" class="img-circle user-headimg"></img>
										<img th:if="${#strings.isEmpty(childComment.author.icon)}" th:src="@{'/images/home/1.jpg'}" class="img-circle user-headimg"></img>
									</a>
									<div class="media-body">
										<div class="meta">
											<strong>
												<a th:href="@{'/front/user/home?id='+${childComment.author.id}}"><span class="color-nickname" th:text="${childComment.author.nickName}">用户昵称</span></a>
											</strong>
											<span class="mhm" th:text="${#dates.format(childComment.createdDate, 'yyyy-MM-dd HH:mm')}">多久前的回复</span>
										</div>
										<div class="content">
											<p th:text="${childComment.content}" style="margin-bottom:0px">回复的具体内容</p>
										</div>
										<div class="text-muted text-normal pull-right">
											<a href="javascript:;" class="reply" th:onclick="'replayCommentChild(\''+${schoolComment.comment.id}+'\',\''+${childComment.author.nickName}+'\')'">回复</a>
										</div>
									</div>
								</li>
							</ul>
							<div class="media">
								<div class="media-body">
									<div class="text-muted text-normal pull-right" style="padding: 5px 10px;background: #fff;border: 1px solid #6bd7df;border-radius: 3px;">
										<a href="javascript:;" th:onclick="'replayComment('+${schoolComment.comment.id}+')'">我也要说</a>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="reply-block" style="display:none;" th:id="'reply_textarea_'+${schoolComment.comment.id}">
						<textarea class="form-control" rows="4" th:id="'textarea_'+${schoolComment.comment.id}"></textarea>
						<div class="text-muted text-normal pull-right" style="margin-top:10px;">
							<button th:onclick="'submitComment('+${schoolComment.comment.id}+')'" class="btn btn-primary btn-report">提交</button>
						</div>
					</div>
				</div>
			</li>
		</ul>
	</div>
	<input type="hidden" id="current_page" th:value="${pageBean.currentpage}" />
	<input type="hidden" id="total_page" th:value="${pageBean.totalpage}" />
	<div class="panel-footer text-center border0" th:if="${pageBean.totalpage > pageBean.currentpage}">
		<div class="row">
			<a href="javascript:;" onclick="getCommentMore()"><span class="text-lg free-fw">查看更多</span></a>
		</div>
	</div>
</div>

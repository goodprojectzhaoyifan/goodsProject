<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org">
<head>
<title>门道教育网－标签管理</title>
<head th:include="layout/head :: backend"></head>
</head>
<body class="index">
	<div th:include="layout/common/header::nav-header"></div>
	<div class="container" id="content-container">
		<div class="row">
			<div th:include="layout/backend_nav::nav-backend"></div>
			<div class="col-md-9">
				<div class="panel panel-default panel-col">
					<div class="panel-heading">标签管理</div>
					<div class="panel-body">
						<form action="">
							<fieldset>
								<legend>查询条件</legend>
								<div class="controls">
									<div class="span4">
										标签名称: <input class="input-medium" name="q_display" type="text" th:value="${display }" />
										&nbsp;&nbsp;&nbsp;&nbsp;
										标签应用范围: 
											<select class="selectpicker" name="q_code">
												<option value="">请选择</option>
												<option th:selected="${code == 'TOPIC_STICKER'}? 'true':'false'" value="TOPIC_STICKER">话题标签</option>
												<option th:selected="${code == 'ACTIVITY_STICKER'}? 'true':'false'" value="ACTIVITY_STICKER">活动标签</option>
												<option th:selected="${code == 'SCHOOL_STICKER'}? 'true':'false'"  value="SCHOOL_STICKER">机构标签</option>
												<option th:selected="${code == 'FOLLOW_STICKER'}? 'true':'false'"  value="FOLLOW_STICKER">关注标签</option>
											</select>
									</div>
								</div>
								<div class="controls span12" style="text-align: center;">
									<button type="submit" class="btn btn-success">查询</button>
									<input type="reset" class="btn btn-primary" value="清空"/>
								</div>
							</fieldset>
						</form>
						<div class="block">
							<div class="navbar navbar-inner block-header">
								<div class="muted pull-left">标签列表</div>
							</div>
							<div class="block-content collapse in">
								<div class="span12">
									<div id="example2_wrapper"
										class="dataTables_wrapper form-inline" role="grid">
										<table cellpadding="0" cellspacing="0" border="0" class="table table-striped table-bordered" id="example2">
											<thead>
												<tr role="row">
													<th width="100%">
														<div class="col-lg-2">标签名称</div>
														<div class="col-lg-2">标签应用范围</div>
														<div class="col-lg-3">排序</div>
														<div class="col-lg-3">操作</div>
													</th>
												</tr>
											</thead>
											<tbody>
												<tr class="odd gradeX" th:each="item: ${pageBean.result}">
													<td width="100%">
														<form th:action="@{/backend/sticker/edit}" name="updateForm" method="post">
															<div class="row">
																<div class="col-lg-2" th:text="${item.display}">*</div>
																<div class="col-lg-2">
																	<input type="hidden" name="display" th:value="${item.display}" />
																	<input type="hidden" name="category.id" th:value="${item.category.id}" />
																	<input type="hidden" name="code" th:value="${item.code}" />
																	<span th:text="${#strings.indexOf(item.code,'TOPIC_STICKER')} lt 0 ?'':'话题标签'"></span>
																	<span th:text="${#strings.indexOf(item.code,'ACTIVITY_STICKER')} lt 0 ?'':'活动标签'"></span>
																	<span th:text="${#strings.indexOf(item.code,'SCHOOL_STICKER')} lt 0 ?'':'机构标签'"></span>
																	<span th:text="${#strings.indexOf(item.code,'FOLLOW_STICKER')} lt 0 ?'':'关注标签'"></span>
																</div>
																<div class="col-lg-3">
																	<input type="text" name="sortSeq" required="required" pattern="^[0-9]{1,3}([.]{1}[0-9]{1,3}){0,10}$" th:value="${item.sortSeq}"/>
																</div>
																<div class="col-lg-3">
																	<input type="hidden" name="id" th:value="${item.id}"/>
																	<input type="submit" value="提交修改"/>
																	<input type="button" id="btnDelete" value="删除"/>
																</div>
															</div>
														</form>
													</td>
												</tr>
											</tbody>
										</table>
										<div class="row">
											<div class="span6">
												<div id="example_info" class="dataTables_info" th:text="${pageBean.totalpage}"></div>
											</div>
											<div class="span6">
												<div th:include="layout/common/pagination :: pagination"></div>
											</div>
										</div>
									</div>
								</div>
							</div>
							<!-- /block -->
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<script th:inline="javascript">
	/*<![CDATA[*/
	$(function(){
		$('form[name=updateForm]').submit(function(){
			$.post($(this).attr('action'), $(this).serialize(), function(data){
				if(!data.mark){
					alert(data.message);
				}
			}, 'json');
			return false;
		});
		$('#example2').click(function(evt){
			var $obj = $(evt.target);
			if($obj.attr('id') == 'btnDelete'){
				var url = /*[[@{/backend/sticker/delete}]]*/;
				url = url + "/" + $obj.parent().children(":first").val();
				$.post(url, null, function(e){
					if(!data.mark){
						alert(data.message);
					}else{
						window.location.reload();
					}
				}, 'json');
			}
		});
	});
	/*]]>*/
	</script>
</body>
</html>